# 工具介绍

本节详细介绍 Pinfi 项目中的各个工具的功能、原理和使用方法。

## 工具列表

### 1. 指令分析工具

#### [instcount_official](./instcount工具/instcount工具.md)
**功能**: 统计程序执行的动态指令总数

**特点**:
- Intel Pin 官方示例工具
- 基于基本块（Basic Block）级别的计数
- 性能开销较小
- 输出简洁明了

---

#### [instcategory](./instcategory工具/instcategory工具.md)
**功能**: 收集并分类程序中执行的指令类别和操作码

**特点**:
- 按照指令类别（Category）进行分组
- 记录每个类别下的所有操作码（Opcode）
- 支持过滤分支指令和栈操作
- 适合了解程序的指令组成

---

#### [saveInstcategory](./saveInstcategory工具/saveInstcategory工具.md)
**功能**: 按照指令类型筛选和保存特定的指令信息

**特点**:
- 支持多种指令类型筛选（整数运算、浮点运算、除法、MOV、栈操作等）
- 可选择仅保存内存读写指令
- 支持静态和动态分析两种模式
- 输出详细的指令信息（地址、助记符、反汇编、寄存器）

---

#### [randomInst](./randomInst工具/randomInst工具.md)
**功能**: 在程序执行过程中随机选择一条指令并记录其详细信息

**特点**:
- 用于故障注入的目标指令选择
- 记录指令的PC、寄存器信息、内存操作类型
- 支持批量生成多个随机指令位置
- 智能处理无效寄存器和标志寄存器

---

### 2. 故障注入工具

#### [faultinjection](./faultinjection工具/faultinjection工具.md)
**功能**: 在程序运行时向寄存器或内存注入故障（位翻转）

**特点**:
- 支持通用寄存器、浮点寄存器、标志寄存器的故障注入
- 支持内存故障注入
- 支持单比特和多比特错误注入
- 可配置注入时机（随机选择指令实例）
- 记录详细的注入信息和程序状态

---

### 3. 辅助分析工具

#### [findnextinst](./findnextinst工具/findnextinst工具.md)
**功能**: 根据给定的PC地址，查找该指令的详细信息和下一条指令

**特点**:
- 获取指令的反汇编代码
- 查找下一条指令的地址
- 分析指令的写寄存器列表
- 判断内存读写操作
- 分析栈操作的详细信息（基址、索引、位移、缩放）

---

#### [getStackInfo](./getStackInfo工具/getStackInfo工具.md)
**功能**: 收集程序执行过程中各个函数的栈指针信息

**特点**:
- 在函数级别进行插桩
- 记录每个函数的栈指针值
- 用于分析栈帧结构
- 辅助理解程序的调用栈状态

---

## 工具使用流程示例

### 典型的故障注入实验流程

1. **指令统计**: 使用 `instcount_official` 统计目标程序的总指令数
2. **指令分类**: 使用 `instcategory` 了解程序的指令组成
3. **目标选择**: 使用 `randomInst` 随机选择故障注入目标指令
4. **故障注入**: 使用 `faultinjection` 执行故障注入实验
5. **结果分析**: 分析程序在故障注入后的行为

### 指令分析流程

1. **粗略统计**: 使用 `instcategory` 获取指令类别概览
2. **精细分析**: 使用 `saveInstcategory` 保存特定类型指令的详细信息
3. **指令定位**: 使用 `findnextinst` 查询特定指令的上下文信息

## 编译和使用

所有工具都需要通过 Pin 框架编译和运行：

```bash
# 编译工具
make obj-intel64/toolname.so

# 运行工具
pin -t obj-intel64/toolname.so [工具参数] -- 目标程序 [程序参数]
```

具体每个工具的编译和使用方法，请参阅各工具的详细文档。
